{% extends 'base.html' %}
{% load static %}

{% block title %}Əsas Səhifə{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<link rel="stylesheet" href="{% static 'css/main.css' %}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="swiper hero-slider">
        <div class="swiper-wrapper">
            {% for slide in hero_slides %}
            <div class="swiper-slide">
                <div class="hero-slide">
                    <img src="{{ slide.sekil.url }}" alt="{{ slide.basliq }}">
                    <div class="hero-content">
                        <h1>{{ slide.basliq }}</h1>
                        <p>{{ slide.alt_basliq }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Yeni Məhsullar Slider -->
<section class="new-products-section">
    <h2 class="section-title">Yeni Məhsullar</h2>
    
    <div class="swiper new-products-slider">
        <div class="swiper-wrapper">
            {% for mehsul in yeni_mehsullar %}
            <div class="swiper-slide">
                <div class="product-card">
                    {% if mehsul.sekil %}
                        <img src="{{ mehsul.sekil.url }}" alt="{{ mehsul.adi }}">
                    {% else %}
                        <img src="{% static 'img/no-image.png' %}" alt="Şəkil yoxdur">
                    {% endif %}
                    <div class="product-info">
                        <h3>{{ mehsul.adi }}</h3>
                        <h4>{{ mehsul.oem }}</h4>
                        <p class="brand">{{ mehsul.brend.adi }}</p>
                        <p class="price">{{ mehsul.formatted_qiymet }} AZN</p>
                        <a href="{% url 'mehsul_haqqinda' mehsul.adi|slugify mehsul.oem|slugify mehsul.brend_kod|slugify mehsul.id %}" class="info-link">
                            <i class="fas fa-info"></i>
                            Ətraflı
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>
</section>

<!-- Müştəri Rəyləri Bölməsi -->
<section class="reviews-section">
    <h2 class="section-title">Müştəri Rəyləri</h2>
    
    <!-- Qiymətləndirmə Statistikası -->
    <div class="rating-stats">
        <div class="average-rating">
            <h3>Ümumi Qiymətləndirmə</h3>
            <div class="rating-value">
                {{ rey_statistikasi.ortalama|default:"0"|floatformat:1 }}
                <i class="fas fa-star"></i>
            </div>
            <div class="total-reviews">
                {{ rey_statistikasi.toplam|default:"0" }} rəy
            </div>
        </div>
        
        <div class="rating-bars">
            {% for stat in ulduz_statistikasi %}
            <div class="rating-bar">
                <span class="stars">{{ stat.qiymetlendirme }} <i class="fas fa-star"></i></span>
                <div class="bar-container">
                    {% if rey_statistikasi.toplam %}
                        <div class="bar" style="width: {% widthratio stat.sayi rey_statistikasi.toplam 100 %}%"></div>
                    {% else %}
                        <div class="bar" style="width: 0%"></div>
                    {% endif %}
                </div>
                <span class="count">{{ stat.sayi }}</span>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Rəy Əlavə Etmə Formu -->
    <div class="review-form">
        <h3>Rəyinizi Bildirin</h3>
        <form method="POST" action="{% url 'esasevim:rey_elave_et' %}">
            {% csrf_token %}
            <div class="rating-input">
                <input type="radio" id="star5" name="qiymetlendirme" value="5">
                <label for="star5"><i class="fas fa-star"></i></label>
                <input type="radio" id="star4" name="qiymetlendirme" value="4">
                <label for="star4"><i class="fas fa-star"></i></label>
                <input type="radio" id="star3" name="qiymetlendirme" value="3">
                <label for="star3"><i class="fas fa-star"></i></label>
                <input type="radio" id="star2" name="qiymetlendirme" value="2">
                <label for="star2"><i class="fas fa-star"></i></label>
                <input type="radio" id="star1" name="qiymetlendirme" value="1">
                <label for="star1"><i class="fas fa-star"></i></label>
            </div>
            <textarea name="rey" placeholder="Rəyinizi yazın..." required></textarea>
            <button type="submit">Göndər</button>
        </form>
    </div>

    <!-- Təsdiqlənmiş Rəylər -->
    <div class="reviews-container">
        {% for rey in reyler %}
        <div class="review-card">
            <div class="review-header">
                <div class="reviewer-info">
                    {% if rey.musteri.profile.sekil %}
                        <img src="{{ rey.musteri.profile.sekil.url }}" alt="Profile">
                    {% else %}
                        <img src="{% static 'img/default-avatar.png' %}" alt="Default Profile">
                    {% endif %}
                    <div class="reviewer-details">
                        <h4>{{ rey.musteri.profile.tam_ad|default:rey.musteri.username }}</h4>
                        <div class="rating">
                            {% for i in "12345"|make_list %}
                            <i class="fas fa-star {% if forloop.counter <= rey.qiymetlendirme %}active{% endif %}"></i>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="review-date">
                    {{ rey.tarix|date:"d.m.Y" }}
                </div>
            </div>
            <div class="review-content">
                {{ rey.rey }}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="{% static 'js/main.js' %}"></script>
{% endblock %}