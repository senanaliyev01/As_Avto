{% extends 'base.html' %}
{% load static %}

{% block title %}{{ mehsul.adi }} - Məhsul Haqqında{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/mehsul_haqqinda.css' %}">
{% endblock %}

{% block content %}
<!-- Məhsul Məlumatları -->
<div class="container py-5">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Ana Səhifə</a></li>
            <li class="breadcrumb-item"><a href="{% url 'mehsullar' %}">Məhsullar</a></li>
            <li class="breadcrumb-item"><a href="{% url 'kateqoriya' mehsul.kateqoriya.slug %}">{{ mehsul.kateqoriya }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ mehsul.adi }}</li>
        </ol>
    </nav>

    <div class="mehsul-container bg-white rounded-lg shadow-sm p-4 mb-5">
        <div class="row">
            <!-- Məhsul Şəkli -->
            <div class="col-lg-5 mb-4 mb-lg-0">
                <div class="mehsul-gallery position-relative">
                    {% if mehsul.sekil %}
                    <div class="product-image-wrapper">
                        <img src="{{ mehsul.sekil.url }}" alt="{{ mehsul.adi }}" class="img-fluid rounded product-image" id="productImage">
                        {% if mehsul.stok == 0 %}
                        <div class="stock-badge out-of-stock">Stokda yoxdur</div>
                        {% elif mehsul.stok <= 20 %}
                        <div class="stock-badge low-stock">Məhdud sayda</div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Məhsul Detalları -->
            <div class="col-lg-7">
                <div class="mehsul-details">
                    <h1 class="product-title mb-3">{{ mehsul.adi }}</h1>
                    
                    <div class="product-meta mb-4">
                        <div class="d-flex align-items-center mb-2">
                            <span class="badge bg-primary me-2">{{ mehsul.kateqoriya }}</span>
                            {% if mehsul.brend.sekilyazi %}
                            <img src="{{ mehsul.brend.sekilyazi.url }}" alt="{{ mehsul.brend.adi }}" class="marka-logo ms-2" style="max-height: 30px;">
                            {% endif %}
                        </div>
                        
                        <div class="product-code text-muted small">
                            <span class="me-3"><i class="fas fa-barcode me-1"></i> Brend kodu: <strong>{{ mehsul.brend_kod }}</strong></span>
                            <span><i class="fas fa-hashtag me-1"></i> OEM: <strong>{{ mehsul.oem }}</strong></span>
                        </div>
                    </div>
                    
                    <div class="specs card mb-4">
                        <div class="card-body p-3">
                            <div class="row mb-2">
                                <div class="col-md-4 fw-bold">Kateqoriya:</div>
                                <div class="col-md-8">{{ mehsul.kateqoriya }}</div>
                            </div>
                            
                            <div class="row mb-2">
                                <div class="col-md-4 fw-bold">Firma:</div>
                                <div class="col-md-8 d-flex align-items-center">
                                    {% if mehsul.brend.sekilyazi %}
                                    <img src="{{ mehsul.brend.sekilyazi.url }}" alt="{{ mehsul.brend.adi }}" class="marka-image me-2" style="max-height: 25px;">
                                    {% endif %}
                                    <span>{{ mehsul.brend.adi }}</span>
                                </div>
                            </div>
                            
                            <div class="row mb-2">
                                <div class="col-md-4 fw-bold">Avtomobil:</div>
                                <div class="col-md-8 d-flex align-items-center flex-wrap">
                                    {% if mehsul.marka.sekiller.all %}
                                        {% for sekil in mehsul.marka.sekiller.all %}
                                            <img src="{{ sekil.sekil.url }}" alt="{{ mehsul.marka.adi }}" class="marka-image-pr-list me-2 mb-1" style="max-height: 25px;">
                                        {% endfor %}
                                    {% else %}
                                        {{ mehsul.marka.adi }}
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="row mb-2">
                                <div class="col-md-4 fw-bold">Brend kodu:</div>
                                <div class="col-md-8">{{ mehsul.brend_kod }}</div>
                            </div>
                            
                            <div class="row mb-2">
                                <div class="col-md-4 fw-bold">OEM:</div>
                                <div class="col-md-8">{{ mehsul.oem }}</div>
                            </div>
                            
                            {% if mehsul.oem_kodlar.all %}
                            <div class="row mb-2">
                                <div class="col-md-4 fw-bold">Dəyişən OEM Kodlar:</div>
                                <div class="col-md-8">
                                    <div class="oem-codes d-flex flex-wrap">
                                        {% for oem in mehsul.oem_kodlar.all %}
                                            <span class="oem-code badge bg-light text-dark me-1 mb-1">{{ oem.kod }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div> 
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="product-actions d-flex flex-column flex-md-row align-items-md-center mb-4">
                        <div class="availability me-md-4 mb-3 mb-md-0">
                            <div class="fw-bold mb-1">Mövcudluq:</div>
                            <span class="stock-status badge {% if mehsul.stok == 0 %}bg-danger{% elif mehsul.stok <= 20 %}bg-warning text-dark{% else %}bg-success{% endif %} p-2">
                                {% if mehsul.stok == 0 %}
                                    <i class="fas fa-times-circle me-1"></i> Stokda yoxdur
                                {% elif mehsul.stok <= 20 %}
                                    <i class="fas fa-exclamation-circle me-1"></i> Az qalıb ({{ mehsul.stok }} ədəd)
                                {% else %}
                                    <i class="fas fa-check-circle me-1"></i> Stokda var
                                {% endif %}
                            </span>
                        </div>
                        
                        <div class="price-block">
                            <div class="fw-bold mb-1">Qiymət:</div>
                            <div class="price-value h3 mb-0 text-primary">{{ mehsul.formatted_qiymet }} <span class="currency">₼</span></div>
                        </div>
                    </div>
                    
                    {% if mehsul.stok > 0 %}
                    <div class="add-to-cart">
                        <a href="{% url 'sebet_ekle' mehsul.id %}" class="btn btn-primary btn-lg d-flex align-items-center justify-content-center" data-product-id="{{ mehsul.id }}">
                            <i class="fas fa-shopping-cart me-2"></i>
                            <span>Səbətə Əlavə Et</span>
                        </a>
                    </div>
                    {% else %}
                    <div class="notify-availability">
                        <button class="btn btn-outline-secondary btn-lg d-flex align-items-center justify-content-center" data-product-id="{{ mehsul.id }}">
                            <i class="fas fa-bell me-2"></i>
                            <span>Məhsul gələndə xəbər ver</span>
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Məhsul Haqqında -->
    {% if mehsul.haqqinda %}
    <div class="product-description bg-white rounded-lg shadow-sm p-4 mb-5">
        <h2 class="section-title border-bottom pb-3 mb-4"><i class="fas fa-info-circle me-2"></i>Məhsul Haqqında</h2>
        <div class="description-content">
            {{ mehsul.haqqinda|linebreaks }}
        </div>
    </div>
    {% endif %}

    <!-- Uyğun Avtomobillər -->
    {% if mehsul.model.all %}
    <div class="compatible-models bg-white rounded-lg shadow-sm p-4 mb-5">
        <h2 class="section-title border-bottom pb-3 mb-4"><i class="fas fa-car me-2"></i>Uyğun Avtomobillər</h2>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-light">
                    <tr>
                        <th>Avtomobil</th>
                        <th>Model</th>
                        <th>Motor</th>
                        <th>Yanacaq</th>
                        <th>İl</th>
                    </tr>
                </thead>
                <tbody>
                    {% for model in mehsul.model.all %}
                    <tr>
                        <td>{{ model.avtomobil.adi }}</td>
                        <td>{{ model.model.adi }}</td>
                        <td>{{ model.motor.motor }}</td>
                        <td>{{ model.yanacaq.yanacaq }}</td>
                        <td>{{ model.il.il }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Brend Haqqında -->
    {% if mehsul.brend.haqqinda or mehsul.brend.sekil %}
    <div class="brand-info bg-white rounded-lg shadow-sm p-4">
        <h2 class="section-title border-bottom pb-3 mb-4"><i class="fas fa-trademark me-2"></i>{{ mehsul.brend.adi }} Şirkəti Haqqında</h2>
        <div class="row">
            {% if mehsul.brend.sekil %}
            <div class="col-md-3 mb-4 mb-md-0">
                <div class="brand-image text-center">
                    <img src="{{ mehsul.brend.sekil.url }}" alt="{{ mehsul.brend.adi }}" class="img-fluid" id="brandImage">
                </div>
            </div>
            {% endif %}
            
            {% if mehsul.brend.haqqinda %}
            <div class="col-md-{% if mehsul.brend.sekil %}9{% else %}12{% endif %}">
                <div class="brand-description">
                    {{ mehsul.brend.haqqinda|linebreaks }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/mehsul_haqqinda.js' %}"></script>
{% endblock %} 