{% extends 'base.html' %}
{% load static %}

{% block title %}Məhsullar{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/products_list.css' %}">
{% endblock %}

{% block content %}

<!-- Axtarış Nəticələriii -->
<div class="search-results">
    <!-- Modal for product image -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <img id="modalImage" src="" alt="">
        </div>
    </div>
    
    {% if mehsullar %}
        <div class="products-table-container">
            <h2 class="search-result-title">{{ mehsullar.count }} Nəticə tapıldı</h2>
            <div class="products-table">
                <table>
                    <thead>
                        <tr>
                            <th>Təsvir</th>
                            <th>Məhsul</th>
                            {% comment %} <th>Firma</th>
                            <th>Avtomobil</th> {% endcomment %}
                            <th>№</th>
                            <th>OEM Kod</th>
                            <th>Mövcudluğ</th>
                            <th>Qiymət</th>
                            <th>Miqdar</th>
                            <th>Səbət</th>
                            <th><i class="fas fa-info"></i></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mehsul in mehsullar %}
                        <tr>
                            <td>
                                {% if mehsul.sekil %}
                                    <img src="{{ mehsul.sekil.url }}" alt="{{ mehsul.adi }}" class="marka-pr-image product-image" onclick="openModal(this.src)">
                                {% endif %}
                            </td>
                            <td>{{ mehsul.adi }}</td>
                            {% comment %} <td>{{ mehsul.brend.adi }}</td>
                            <td>{{ mehsul.marka.adi }}</td> {% endcomment %}
                            <td>{{ mehsul.brend_kod }}</td>
                            <td>{{ mehsul.oem }}
                            {% comment %} <a href="#" title="OEM kodunu axtar" onclick="window.open('https://www.google.com/search?tbm=isch&q={{ mehsul.oem }}', 'googleImages', 'width=600,height=600'); return false;">
                                    <i class="fas fa-camera" style="color:green; margin-left: 5px; cursor: pointer; transition: all 0.3s ease-in-out;"
                                       onmouseover="this.style.color='darkgreen'; this.style.transform='scale(1.2)';"
                                       onmouseout="this.style.color='green'; this.style.transform='scale(1)';">
                                    </i>
                                </a> {% endcomment %}
                            </td>
                            <td>
                                {% if mehsul.stok == 0 %}
                                    <span class="stock-status out-of-stock">Yoxdur</span>
                                {% elif mehsul.stok <= 20 %}
                                    <span class="stock-status low-stock">Az var</span>
                                {% else %}
                                    <span class="stock-status in-stock">Var</span>
                                {% endif %}
                            </td>
                            <td class="price-column">
                                {{ mehsul.formatted_qiymet }}
                                <i class="fa-solid fa-manat-sign" style="font-size: 0.9em; margin-left: 2px;"></i>
                            </td>
                            <td>
                                <div class="quantity-container">
                                    <input type="number" 
                                           class="quantity-input" 
                                           value="1" 
                                           min="1" 
                                           max="999"
                                           data-product-id="{{ mehsul.id }}"
                                           onchange="validateQuantity(this)">
                                    <div class="quantity-error"></div>
                                </div>
                            </td>
                            <td>
                                <button onclick="addToCartWithQuantity({{ mehsul.id }})" 
                                        class="cart-icon">
                                    <i class="fas fa-shopping-cart"></i>
                                </button>
                            </td>
                            <td>
                                <a href="{% url 'mehsul_haqqinda' mehsul.adi|slugify mehsul.oem|slugify mehsul.brend_kod|slugify mehsul.id %}" class="info-link">
                                    <i class="fas fa-info"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% else %}
        <h2 class="no-results" style="color: red">Heç bir nəticə tapılmadı. Zəhmət olmasa axtarış parametrlərini yoxlayın.</h2>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/products_list.js' %}"></script>
{% if request.GET.search_text %}
<script>
    // Axtarış sözünü JavaScript-ə ötürürük
    document.addEventListener('DOMContentLoaded', function() {
        highlightSearchTerms();
    });
</script>
{% endif %}
{% endblock %}
