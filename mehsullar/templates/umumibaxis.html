{% extends 'base.html' %}
{% load static %}

{% block title %}Ümumi Məhsullara Baxış{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/umumibaxis.css' %}">
{% endblock %}

{% block content %}
<!-- Filter Section -->
<div class="filter-container">
    <div class="filter-header">
        <h2>Filterlər</h2>
        <button id="clear-filters">Təmizlə</button>
    </div>
    <div class="filter-body">
        <div class="filter-group">
            <label for="category-filter">Kateqoriya</label>
            <select id="category-filter" class="filter-select">
                <option value="">Hamısı</option>
                {% for kateqoriya in kateqoriyalar %}
                    <option value="{{ kateqoriya.adi }}">{{ kateqoriya.adi }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="filter-group">
            <label for="brand-filter">Firma</label>
            <select id="brand-filter" class="filter-select">
                <option value="">Hamısı</option>
                {% for brend in brendler %}
                    <option value="{{ brend.adi }}">{{ brend.adi }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="filter-group">
            <label for="model-filter">Avtomobil</label>
            <select id="model-filter" class="filter-select">
                <option value="">Hamısı</option>
                {% for marka in markalar %}
                    <option value="{{ marka.adi }}">{{ marka.adi }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="filter-group">
            <label for="stock-filter">Stok vəziyyəti</label>
            <select id="stock-filter" class="filter-select">
                <option value="">Hamısı</option>
                <option value="in-stock">Var</option>
                <option value="low-stock">Az var</option>
                <option value="out-of-stock">Yoxdur</option>
            </select>
        </div>
    </div>
</div>

<div class="product-list" id="product-container">
    {% for mehsul in mehsullar %}
    <div class="product-card" 
         data-category="{{ mehsul.kateqoriya }}" 
         data-brand="{{ mehsul.brend.adi }}" 
         data-model="{{ mehsul.marka.adi }}"
         data-stock="{% if mehsul.stok == 0 %}out-of-stock{% elif mehsul.stok <= 20 %}low-stock{% else %}in-stock{% endif %}">
        <div class="product-image12">
            {% if mehsul.sekil %}
                <img src="{{ mehsul.sekil.url }}" alt="{{ mehsul.adi }}">
            {% endif %}
        </div>
        <div class="product-details">
            <h3 class="product-title">{{ mehsul.adi }}</h3>
            <p class="product-category">Kateqoriya: {{ mehsul.kateqoriya }}</p>
            <p class="product-brand">Firma: {{ mehsul.brend.adi }}</p>
            <p class="product-model">Avtomobil: {{ mehsul.marka.adi }}</p>
            <p class="product-oem">KOD: {{ mehsul.oem }}</p>
            <p class="product-price">Qiymət: {{ mehsul.qiymet }} ₼</p>
            <p class="product-stock-status">
                {% if mehsul.stok == 0 %}
                    <span class="stock-status out-of-stock">Yoxdur</span>
                {% elif mehsul.stok <= 20 %}
                    <span class="stock-status low-stock">Az var</span>
                {% else %}
                    <span class="stock-status in-stock">Var</span>
                {% endif %}
            </p>
            <div class="product-actions">
                <a href="{% url 'mehsul_haqqinda' mehsul.adi|slugify mehsul.oem|slugify mehsul.brend_kod|slugify mehsul.id %}" class="info-link">Ətraflı</a>
                <div class="quantity-container">
                    <input type="number" 
                           class="quantity-input" 
                           value="1" 
                           min="1" 
                           max="999"
                           data-product-id="{{ mehsul.id }}"
                           onchange="validateQuantity(this)">
                    <div class="quantity-error"></div>
                </div>
                <button onclick="addToCartWithQuantity({{ mehsul.id }})" class="cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                </button>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- No Results Message -->
<div id="no-results" class="no-results-message" style="display: none;">
    <i class="fas fa-search"></i>
    <h3>Heç bir nəticə tapılmadı</h3>
    <p>Zəhmət olmasa, filter parametrlərini dəyişdirin və ya təmizləyin.</p>
    <button id="reset-filters" class="reset-button">Filterləri təmizlə</button>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/umumi_baxis.js' %}"></script>
{% endblock %}