{% load static %}
<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Satıcı Paneli{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="admin-layout" id="adminLayout">
        <!-- Sidebar -->
        <aside class="admin-sidebar" id="adminSidebar">
            <div class="sidebar-header">
                <a href="{% url 'seller_admin_panel' %}" class="admin-panel-link">
                    <i class="fas fa-cogs"></i> <span class="sidebar-title-text">Satıcı Paneli</span>
                </a>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="sidebar-nav-item {% if request.resolver_match.url_name == 'my_products' %}active{% endif %}">
                        <a href="{% url 'my_products' %}" data-title="Mənim Məhsullarım">
                            <i class="fas fa-box"></i> 
                            <span class="nav-text">Mənim Məhsullarım</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item {% if request.resolver_match.url_name == 'my_sales' %}active{% endif %}">
                        <a href="{% url 'my_sales' %}" id="sidebarMySalesLink" data-title="Mənə gələn sifarişlər">
                            <i class="fas fa-receipt"></i> 
                            <span class="nav-text">Mənə gələn sifarişlər</span>
                            <span id="salesBadge" class="sales-badge-sidebar" style="display:none; margin-left:8px; background:#dc3545;color:white;border-radius:10px;padding:2px 8px;font-size:12px;font-weight:bold;vertical-align:middle;">0</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>
        <!-- Main Content -->
        <div class="admin-main" id="adminMain">
            <!-- Header -->
            <header class="admin-header">
                <div class="admin-header-left">
                    <button id="sidebarToggle" class="sidebar-toggle-btn" title="Sidebar-ı aç/bağla">
                        <i class="fas fa-bars"></i>
                    </button>
                    <span class="admin-header-title">{% block panel_title %}Satıcı Paneli{% endblock %}</span>
                </div>
                <div class="admin-header-right">
                    <span class="admin-user">
                        <img src="{{ request.user.profile.sekil.url|default:'/static/images/no_image.jpg' }}" alt="Profil şəkli" class="admin-user-avatar" style="width:36px;height:36px;border-radius:50%;object-fit:cover;margin-right:8px;vertical-align:middle;">
                        {{ request.user.username }}
                    </span>
                    <a href="{% url 'base' %}" class="admin-site-link" style="margin-right: 16px;"><i class="fas fa-globe"></i> Sayta bax</a>
                    <a href="{% url 'logout' %}" class="admin-logout"><i class="fas fa-sign-out-alt"></i> Çıxış</a>
                </div>
            </header>
            <main class="admin-content">
                {% block content %}{% endblock %}
            </main>
            <footer class="admin-footer">
                <span>© {{ now|date:'Y' }} AS-AVTO Satıcı Paneli. Bütün hüquqlar qorunur.</span>
            </footer>
        </div>
    </div>
    <!-- Şəkil Modalı -->
    <div id="imageModal" class="image-modal" style="display:none;">
        <span class="image-modal-close" style="position:absolute;right:20px;top:20px;cursor:pointer;font-size:24px;">&times;</span>
        <div class="modal-image-content">
            <img id="modalImage" class="modal-image" src="" alt="Modal Image" style="max-width:100%;max-height:80vh;display:block;margin:auto;">
        </div>
    </div>
    <!-- İstifadəçi Detalları Modalı -->
    <div id="userDetailsModal" class="details-modal" style="display:none;">
        <div class="details-modal-content">
            <span class="user-details-modal-close" style="position:absolute;right:20px;top:20px;cursor:pointer;font-size:24px;">&times;</span>
            <div class="details-content">
                <div class="details-header">
                    <h3>İstifadəçi Məlumatları</h3>
                </div>
                <div class="details-body">
                    <div class="details-info text-center">
                        <img id="userDetailsImage" src="" alt="Profil şəkli" style="width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:10px;">
                        <div class="info-row">
                            <span class="info-label">İstifadəçi adı:</span>
                            <span id="userDetailsUsername" class="info-value"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Telefon:</span>
                            <span id="userDetailsPhone" class="info-value"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Ünvan:</span>
                            <span id="userDetailsAddress" class="info-value"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'js/base.js' %}"></script>
    {% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Real-time sales badge və mesaj səsi üçün kod
    (function() {
        let lastSalesCount = parseInt(localStorage.getItem('lastSalesCount') || '0', 10);
        function playSalesSound() {
            try {
                const audio = new Audio('/static/sounds/new_order.mp3');
                audio.currentTime = 0;
                audio.play().catch(() => {});
            } catch (e) {}
        }
        function updateSalesBadge(count) {
            const badge = document.getElementById('salesBadge');
            if (!badge) return;
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'inline-block';
            } else {
                badge.textContent = '0';
                badge.style.display = 'none';
            }
        }
        function pollSalesCount() {
            fetch('/api/unread-sales-count/', { credentials: 'same-origin' })
                .then(res => res.json())
                .then(data => {
                    if (typeof data.count === 'number') {
                        updateSalesBadge(data.count);
                        if (data.count > lastSalesCount) {
                            playSalesSound();
                        }
                        lastSalesCount = data.count;
                        localStorage.setItem('lastSalesCount', lastSalesCount);
                    }
                });
        }
        setInterval(pollSalesCount, 10000);
        pollSalesCount();
        // Linkə kliklədikdə sayğacı sıfırla
        const salesLink = document.getElementById('sidebarMySalesLink');
        if (salesLink) {
            salesLink.addEventListener('click', function() {
                fetch('/api/unread-sales-count/', { method: 'POST', credentials: 'same-origin' })
                    .then(() => {
                        updateSalesBadge(0);
                        lastSalesCount = 0;
                        localStorage.setItem('lastSalesCount', '0');
                    });
            });
        }
    })();

    // Sidebar Toggle Functionality
    document.addEventListener('DOMContentLoaded', function() {
        const sidebarToggle = document.getElementById('sidebarToggle');
        const adminLayout = document.getElementById('adminLayout');
        const adminSidebar = document.getElementById('adminSidebar');
        const adminMain = document.getElementById('adminMain');
        
        // Get saved state from localStorage
        const sidebarCollapsed = localStorage.getItem('adminSidebarCollapsed') === 'true';
        
        // Apply initial state
        if (sidebarCollapsed) {
            adminLayout.classList.add('sidebar-collapsed');
        }
        
        sidebarToggle.addEventListener('click', function() {
            adminLayout.classList.toggle('sidebar-collapsed');
            
            // Save state to localStorage
            const isCollapsed = adminLayout.classList.contains('sidebar-collapsed');
            localStorage.setItem('adminSidebarCollapsed', isCollapsed);
        });
    });
    </script>
    {% endblock %}
</body>
</html> 