{% load static %}
<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Satıcı Paneli{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">
    {% block extra_css %}{% endblock %}
    <style>
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }
        .stat-card.products { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-card.sales { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card.revenue { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .stat-card.orders { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .dashboard-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        .recent-orders {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        .quick-actions {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        .order-item:last-child {
            border-bottom: none;
        }
        .order-info h4 {
            margin: 0;
            font-size: 1rem;
            color: #2c3e50;
        }
        .order-info p {
            margin: 5px 0 0 0;
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        .order-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-processing { background: #cce5ff; color: #004085; }
        .status-completed { background: #d4edda; color: #155724; }
        .quick-action-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-weight: 500;
        }
        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: white;
            text-decoration: none;
        }
        .quick-action-btn.products { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .quick-action-btn.sales { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .quick-action-btn.pdf { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .welcome-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        .welcome-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .welcome-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        @media (max-width: 768px) {
            .dashboard-content {
                grid-template-columns: 1fr;
            }
            .dashboard-stats {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <a href="{% url 'seller_admin_panel' %}" class="admin-panel-link">
                    <i class="fas fa-cogs"></i> Satıcı Paneli
                </a>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="sidebar-nav-item {% if request.resolver_match.url_name == 'my_products' %}active{% endif %}">
                        <a href="{% url 'my_products' %}"><i class="fas fa-box"></i> Mənim Məhsullarım</a>
                    </li>
                    <li class="sidebar-nav-item {% if request.resolver_match.url_name == 'my_sales' %}active{% endif %}">
                        <a href="{% url 'my_sales' %}" id="sidebarMySalesLink">
                            <i class="fas fa-receipt"></i> Mənə gələn sifarişlər
                            <span id="salesBadge" class="sales-badge-sidebar" style="display:none; margin-left:8px; background:#dc3545;color:white;border-radius:10px;padding:2px 8px;font-size:12px;font-weight:bold;vertical-align:middle;">0</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>
        <!-- Main Content -->
        <div class="admin-main">
            <!-- Header -->
            <header class="admin-header">
                <div class="admin-header-left">
                    <span class="admin-header-title">{% block panel_title %}Satıcı Paneli{% endblock %}</span>
                </div>
                <div class="admin-header-right">
                    <span class="admin-user">
                        <img src="{{ request.user.profile.sekil.url|default:'/static/images/no_image.jpg' }}" alt="Profil şəkli" class="admin-user-avatar" style="width:36px;height:36px;border-radius:50%;object-fit:cover;margin-right:8px;vertical-align:middle;">
                        {{ request.user.username }}
                    </span>
                    <a href="{% url 'base' %}" class="admin-site-link" style="margin-right: 16px;"><i class="fas fa-globe"></i> Sayta bax</a>
                    <a href="{% url 'logout' %}" class="admin-logout"><i class="fas fa-sign-out-alt"></i> Çıxış</a>
                </div>
            </header>
            <main class="admin-content">
                {% block content %}
                <!-- Dashboard Content -->
                <div class="welcome-section">
                    <div class="welcome-title">Xoş gəlmisiniz, {{ request.user.username }}!</div>
                    <div class="welcome-subtitle">Satıcı panelinizə xoş gəlmisiniz. Burada bütün məhsullarınızı və sifarişlərinizi idarə edə bilərsiniz.</div>
                </div>

                <div class="dashboard-stats">
                    <div class="stat-card products">
                        <div class="stat-icon"><i class="fas fa-box"></i></div>
                        <div class="stat-value">{{ total_products|default:"0" }}</div>
                        <div class="stat-label">Ümumi Məhsul</div>
                    </div>
                    <div class="stat-card sales">
                        <div class="stat-icon"><i class="fas fa-receipt"></i></div>
                        <div class="stat-value">{{ total_orders|default:"0" }}</div>
                        <div class="stat-label">Ümumi Sifariş</div>
                    </div>
                    <div class="stat-card revenue">
                        <div class="stat-icon"><i class="fas fa-money-bill-wave"></i></div>
                        <div class="stat-value">{{ total_revenue|default:"0"|floatformat:0 }} ₼</div>
                        <div class="stat-label">Ümumi Gəlir</div>
                    </div>
                    <div class="stat-card orders">
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        <div class="stat-value">{{ pending_orders|default:"0" }}</div>
                        <div class="stat-label">Gözləyən Sifariş</div>
                    </div>
                </div>

                <div class="dashboard-content">
                    <div class="recent-orders">
                        <div class="section-title">
                            <i class="fas fa-history"></i>
                            Son Sifarişlər
                        </div>
                        {% if recent_orders %}
                            {% for order in recent_orders %}
                            <div class="order-item">
                                <div class="order-info">
                                    <h4>Sifariş #{{ order.id }}</h4>
                                    <p>{{ order.istifadeci.username }} • {{ order.tarix|date:"d M Y, H:i" }}</p>
                                </div>
                                <div class="order-status status-{{ order.status|lower }}">
                                    {{ order.get_status_display }}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p style="text-align: center; color: #7f8c8d; margin-top: 20px;">Hələ heç bir sifariş yoxdur.</p>
                        {% endif %}
                    </div>

                    <div class="quick-actions">
                        <div class="section-title">
                            <i class="fas fa-bolt"></i>
                            Sürətli Əməliyyatlar
                        </div>
                        <a href="{% url 'my_products' %}" class="quick-action-btn products">
                            <i class="fas fa-plus"></i> Yeni Məhsul Əlavə Et
                        </a>
                        <a href="{% url 'my_sales' %}" class="quick-action-btn sales">
                            <i class="fas fa-eye"></i> Sifarişləri Görüntülə
                        </a>
                        <a href="{% url 'my_products_pdf' %}" class="quick-action-btn pdf" target="_blank">
                            <i class="fas fa-file-pdf"></i> Məhsulları PDF-ə Çıxar
                        </a>
                    </div>
                </div>
                {% endblock %}
            </main>
            <footer class="admin-footer">
                <span>© {{ now|date:'Y' }} AS-AVTO Satıcı Paneli. Bütün hüquqlar qorunur.</span>
            </footer>
        </div>
    </div>
    <!-- Şəkil Modalı -->
    <div id="imageModal" class="image-modal" style="display:none;">
        <span class="image-modal-close" style="position:absolute;right:20px;top:20px;cursor:pointer;font-size:24px;">&times;</span>
        <div class="modal-image-content">
            <img id="modalImage" class="modal-image" src="" alt="Modal Image" style="max-width:100%;max-height:80vh;display:block;margin:auto;">
        </div>
    </div>
    <!-- İstifadəçi Detalları Modalı -->
    <div id="userDetailsModal" class="details-modal" style="display:none;">
        <div class="details-modal-content">
            <span class="user-details-modal-close" style="position:absolute;right:20px;top:20px;cursor:pointer;font-size:24px;">&times;</span>
            <div class="details-content">
                <div class="details-header">
                    <h3>İstifadəçi Məlumatları</h3>
                </div>
                <div class="details-body">
                    <div class="details-info text-center">
                        <img id="userDetailsImage" src="" alt="Profil şəkli" style="width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:10px;">
                        <div class="info-row">
                            <span class="info-label">İstifadəçi adı:</span>
                            <span id="userDetailsUsername" class="info-value"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Telefon:</span>
                            <span id="userDetailsPhone" class="info-value"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Ünvan:</span>
                            <span id="userDetailsAddress" class="info-value"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'js/base.js' %}"></script>
    {% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Real-time sales badge və mesaj səsi üçün kod
    (function() {
        let lastSalesCount = parseInt(localStorage.getItem('lastSalesCount') || '0', 10);
        function playSalesSound() {
            try {
                const audio = new Audio('/static/sounds/new_order.mp3');
                audio.currentTime = 0;
                audio.play().catch(() => {});
            } catch (e) {}
        }
        function updateSalesBadge(count) {
            const badge = document.getElementById('salesBadge');
            if (!badge) return;
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'inline-block';
            } else {
                badge.textContent = '0';
                badge.style.display = 'none';
            }
        }
        function pollSalesCount() {
            fetch('/api/unread-sales-count/', { credentials: 'same-origin' })
                .then(res => res.json())
                .then(data => {
                    if (typeof data.count === 'number') {
                        updateSalesBadge(data.count);
                        if (data.count > lastSalesCount) {
                            playSalesSound();
                        }
                        lastSalesCount = data.count;
                        localStorage.setItem('lastSalesCount', lastSalesCount);
                    }
                });
        }
        setInterval(pollSalesCount, 10000);
        pollSalesCount();
        // Linkə kliklədikdə sayğacı sıfırla
        const salesLink = document.getElementById('sidebarMySalesLink');
        if (salesLink) {
            salesLink.addEventListener('click', function() {
                fetch('/api/unread-sales-count/', { method: 'POST', credentials: 'same-origin' })
                    .then(() => {
                        updateSalesBadge(0);
                        lastSalesCount = 0;
                        localStorage.setItem('lastSalesCount', '0');
                    });
            });
        }
    })();
    </script>
    {% endblock %}
</body>
</html> 