{% load static %}
<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AS-Avto{% endblock %}</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/png" sizes="128x128" href="{% static 'img/favicon.png' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="{% static 'css/base.css' %}">

    {% block extra_css %}{% endblock %}
    
    <!-- NOVRUZ BAYRAMI CSS - BAŞLANĞIC -->
    <style>
        /* Novruz bayramı üçün əlavə stillər */
        header {
            position: relative;
            padding-top: 40px !important; /* Novruz başlığı üçün yer */
            overflow: visible !important;
        }
        
        .novruz-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        
        /* Taxta effekti */
        .wood-texture {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://img.freepik.com/free-photo/wooden-textured-background_53876-14865.jpg');
            background-size: cover;
            opacity: 0.15;
            z-index: -1;
        }
        
        /* Alov animasiyası */
        .flame {
            position: absolute;
            width: 60px;
            height: 60px;
            background-image: url('https://media.giphy.com/media/3o7qDJKIO5rSeyHhvO/giphy.gif');
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 10;
            pointer-events: none;
        }
        
        .flame-left {
            top: 10px;
            left: 220px;
            transform: scale(0.8);
        }
        
        .flame-right {
            top: 10px;
            left: 280px;
            transform: scale(0.8);
        }
        
        /* Otluq effekti */
        .grass-effect {
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 30px;
            background-image: url('https://www.transparentpng.com/thumb/grass/green-grass-png-pictures-7.png');
            background-size: contain;
            background-repeat: repeat-x;
            z-index: 5;
        }
        
        /* Semeni */
        .semeni {
            position: absolute;
            width: 40px;
            height: 40px;
            background-image: url('https://i.pinimg.com/originals/a0/5a/d9/a05ad9fadf22ee675e6b4cf7dc0053ef.png');
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 6;
        }
        
        .semeni-1 {
            bottom: 5px;
            left: 10%;
        }
        
        .semeni-2 {
            bottom: 5px;
            left: 30%;
        }
        
        .semeni-3 {
            bottom: 5px;
            right: 30%;
        }
        
        .semeni-4 {
            bottom: 5px;
            right: 10%;
        }
        
        /* Novruz bayramı yazısı */
        .novruz-title {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            color: #FF6D00;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            z-index: 10;
        }
        
        /* Top header-in yenilənmiş stili */
        .top-header {
            position: relative;
            z-index: 5;
        }
        
        /* Responsive düzəlişlər */
        @media (max-width: 768px) {
            .flame-left {
                left: 10px;
            }
            
            .flame-right {
                left: auto;
                right: 10px;
            }
            
            .novruz-title {
                font-size: 12px;
            }
        }
    </style>
    <!-- NOVRUZ BAYRAMI CSS - SON -->
</head>
<body>
    {% if user.is_authenticated %}
    <script>
        const currentUserId = {{ user.id }};
        const isAdmin = {% if user.is_staff %}true{% else %}false{% endif %};
    </script>
    {% endif %}
    
    <!-- Header r-->
    <header>
        <!-- NOVRUZ BAYRAMI ELEMENTLƏRİ - BAŞLANĞIC -->
        <div class="novruz-header">
            <div class="wood-texture"></div>
            <div class="flame flame-left"></div>
            <div class="flame flame-right"></div>
            <div class="grass-effect"></div>
            <div class="semeni semeni-1"></div>
            <div class="semeni semeni-2"></div>
            <div class="semeni semeni-3"></div>
            <div class="semeni semeni-4"></div>
            <div class="novruz-title">Novruz Bayramınız Mübarək!</div>
        </div>
        <!-- NOVRUZ BAYRAMI ELEMENTLƏRİ - SON -->
        
        <div class="top-header">
            <div class="logo">
                <a href="{% url 'esasevim:main' %}"><img src="{% static '/img/Header_Logo.png' %}" alt="Logo"></a>
             
            </div>
            
            <!-- Search Container -->
            <div class="search-container">
                <div class="search-bar">
                    <form id="search-form" method="GET" action="{% url 'products_list' %}">
                        <select name="category" id="category">
                            <option value="">Kateqoriya</option>
                            {% for category in request.kateqoriyalar %}
                                <option value="{{ category.adi }}" {% if request.GET.category == category.adi %}selected{% endif %}>
                                    {{ category.adi }}
                                </option>
                            {% endfor %}
                        </select>

                        <select name="brand" id="brand">
                            <option value="">Firma</option>
                            {% for brand in request.brendler %}
                                <option value="{{ brand.adi }}" {% if request.GET.brand == brand.adi %}selected{% endif %}>
                                    {{ brand.adi }}
                                </option>
                            {% endfor %}
                        </select>

                        <select name="model" id="model">
                            <option value="">Avtomobil</option>
                            {% for marka in request.markalar %}
                                <option value="{{ marka.adi }}" {% if request.GET.model == marka.adi %}selected{% endif %}>
                                    {{ marka.adi }}
                                </option>
                            {% endfor %}
                        </select>

                        <input type="text" name="search_text" placeholder="Axtarış" value="{{ request.GET.search_text }}">
                        
                        <button type="submit" id="search-button">
                            Axtar
                            <div id="loading-spinner" class="loading-spinner" style="display: none;">
                                <div class="spinner"></div>
                            </div>
                        </button>
                    </form>
                </div>
            </div>

            <div class="header-right">
                <a href="{% url 'profile' %}" class="header-profile-link">
                    <img src="{{ user.profile.sekil.url }}" alt="{{ user.username }}" class="header-profile-image">
                    {{ user.username }}
                </a>
                <a href="#" class="cart-link" id="cart-toggle" onclick="toggleCartModal(event)">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cart-count" class="cart-badge">0</span>
                    <span id="cart-total-badge" class="cart-total-badge">0 ₼</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Navbar -->
    <div class="nav-toggle">
        <i class="fa-solid fa-caret-right"></i>
    </div>

    <nav class="nav-bar">
        <div class="nav-header">
            <h3>Menyu</h3>
            <button class="nav-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="nav-links">
            <a href="{% url 'esasevim:main' %}"><i class="fa-solid fa-house"></i> Əsas Səhifə</a>
            <a href="{% url 'profile' %}"><i class="fas fa-user-circle"></i> Hesabım</a>
            <a href="{% url 'products_list' %}"><i class="fa-solid fa-box"></i> Məhsullar</a>
            <a href="{% url 'umumi_baxis' %}"><i class="fas fa-box-open"></i> Məhsullara Baxış</a>
            <a href="{% url 'esasevim:yeni_mehsullar' %}"><i class="fa-solid fa-bell"></i> Yeni Məhsullar</a>
            <a href="{% url 'sifaris_izle' %}"><i class="fas fa-shopping-bag"></i> Sifarişlərim</a>
            <a href="{% url 'hesabatlar' %}"><i class="fas fa-chart-bar"></i> Hesabatlar</a>
            {% comment %} <a href="{% url 'car_list' %}"><i class="fas fa-car"></i> Avtomobillər</a> {% endcomment %}
            <a href="{% url 'about' %}"><i class="fas fa-info-circle"></i> Məlumat</a>
        </div>
    </nav>

    <div class="nav-overlay"></div>

    <!-- Main Content -->
    <div class="main-content">
        {% block content %}{% endblock %}
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-left">
                <img src="{% static '/img/Header_Logo.png' %}" alt="Logo">
                <p>AS-Avto - Avtomobil ehtiyat hissələri üzrə Azərbaycanda lider şirkət. Keyfiyyətli xidmət və məhsullar təqdim edirik.</p>
            </div>
            <div class="footer-center">
                <h3>Əlaqə</h3>
                <a href="tel:+994702754499"><i class="fa-solid fa-tty"></i>+994 70 275 44 99</a>
                <a href="tel:+994773059585"><i class="fas fa-phone-alt"></i>+994 77 305 95 85</a>
                <a href="mailto:senan.eliyev.9997@gmail.com"><i class="fas fa-envelope"></i>senan.eliyev.9997@gmail.com</a>
                <a href="https://maps.app.goo.gl/fU5jUAg8veccL3Zq9"><i class="fa-solid fa-location-dot"></i>Binəqədi R. M.Rəsulzadə qəs. As-Avto</a>
            </div>
            <div class="footer-right">
                <h3>Bizi izləyin</h3>
                <div class="social-links">
                    <a href="https://wa.me/994773059585" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    <a href="https://www.tiktok.com/@as_avto_service" target="_blank"><i class="fab fa-tiktok"></i></a>
                    <a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" target="_blank"><i class="fab fa-instagram"></i></a>
                </div>
                
                <div class="working-hours-container">
                    <h4>İş saatları</h4>
                    <div class="working-hours-list">
                        <div class="working-hours-item">
                            <span>Bazar ertəsi - Cümə:</span>
                            <span>09:00 - 18:00</span>
                        </div>
                        <div class="working-hours-item">
                            <span>Şənbə:</span>
                            <span>09:00 - 17:00</span>
                        </div>
                        <div class="working-hours-item">
                            <span>Bazar:</span>
                            <span>İstirahət</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; {% now "Y" %} AS-Avto. Bütün hüquqlar qorunur. | Dizayn: <a href="#">AS-Avto</a></p>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div id="cart-modal" class="cart-modal">
        <div class="cart-modal-content">
            <div class="cart-modal-header">
                <h2>Səbətim</h2>
                <span class="cart-close">&times;</span>
            </div>
            <div class="cart-modal-body">
                <div id="cart-items-container">
                    <!-- Səbət məlumatları JavaScript ilə doldurulacaq -->
                    <div class="loading-spinner-container">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
            <div class="cart-modal-footer">
                <div class="cart-total">
                    <span>Ümumi Cəmi:</span>
                    <span id="cart-modal-total">0 ₼</span>
                </div>
                <div class="cart-actions">
                    <a href="{% url 'view_cart' %}" class="view-cart-btn">Səbətə Keç</a>
                </div>
            </div>
        </div>
    </div>

    {% if user.is_authenticated %}
  

    <!-- Chat widget -->
    <div id="chat-widget" class="chat-widget">
        <div id="chat-icon" class="chat-icon">
            <i class="fas fa-comments"></i>
            <span id="total-unread" class="unread-count" style="display: none;">0</span>
        </div>
        
        <div id="chat-window" class="chat-window" style="display: none;">
            <div class="chat-header">
                <div class="chat-title">Dəstək Komandası</div>
                <button id="close-chat" class="close-button">&times;</button>
            </div>
            
            <div class="chat-container">
                <!-- İstifadəçilər siyahısı -->
                <div class="chat-sidebar">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="user-search" placeholder="İstifadəçi axtar...">
                    </div>
                    <div id="users-list" class="users-list"></div>
                </div>
                
                <!-- Mesajlaşma bölməsi -->
                <div class="chat-main" style="display: none;">
                    <div class="selected-user">
                        <i class="fas fa-arrow-left" id="back-to-users"></i>
                        <span id="selected-username"></span>
                    </div>
                    <div class="chat-messages" id="chat-messages"></div>
                    <div class="chat-input">
                        <input type="text" id="message-input" placeholder="Mesajınızı yazın...">
                        <button id="send-message" type="button">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Common Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="{% static 'js/loading.js' %}"></script>
    <script src="{% static 'js/base.js' %}"></script>
    <script src="{% static 'js/chat.js' %}"></script>
    {% block extra_js %}{% endblock %}

    <!-- NOVRUZ BAYRAMI JS - BAŞLANĞIC -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Alov animasiyası
            const flameLeft = document.querySelector('.flame-left');
            const flameRight = document.querySelector('.flame-right');
            
            // Alovların kiçik hərəkəti
            function animateFlames() {
                // Sol alov
                const leftX = Math.sin(Date.now() / 1000) * 5;
                const leftY = Math.cos(Date.now() / 1500) * 3;
                flameLeft.style.transform = `translate(${leftX}px, ${leftY}px) scale(0.8)`;
                
                // Sağ alov
                const rightX = Math.sin(Date.now() / 1200) * 5;
                const rightY = Math.cos(Date.now() / 1700) * 3;
                flameRight.style.transform = `translate(${rightX}px, ${rightY}px) scale(0.8)`;
                
                requestAnimationFrame(animateFlames);
            }
            
            // Semeni animasiyası - yavaş yuxarı-aşağı hərəkət
            const semenis = document.querySelectorAll('.semeni');
            
            function animateSemenis() {
                semenis.forEach((semeni, index) => {
                    const offset = Math.sin(Date.now() / 1000 + index) * 3;
                    semeni.style.transform = `translateY(${offset}px)`;
                });
                
                requestAnimationFrame(animateSemenis);
            }
            
            // Otluq animasiyası - yavaş dalğalanma
            const grass = document.querySelector('.grass-effect');
            let grassPosition = 0;
            
            function animateGrass() {
                grassPosition -= 0.5;
                if (grassPosition <= -100) {
                    grassPosition = 0;
                }
                grass.style.backgroundPosition = `${grassPosition}px bottom`;
                
                requestAnimationFrame(animateGrass);
            }
            
            // Novruz yazısının rəng dəyişməsi
            const novruzTitle = document.querySelector('.novruz-title');
            let hue = 0;
            
            function animateTitle() {
                hue = (hue + 1) % 360;
                novruzTitle.style.color = `hsl(${hue}, 100%, 50%)`;
                
                setTimeout(animateTitle, 100);
            }
            
            // Animasiyaları başlat
            animateFlames();
            animateSemenis();
            animateGrass();
            animateTitle();
        });
    </script>
    <!-- NOVRUZ BAYRAMI JS - SON -->
</body>
</html>
