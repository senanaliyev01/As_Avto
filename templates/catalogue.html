<!DOCTYPE html>
{% load static %}
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kataloq | AS-AVTO | Avtomobil Ehtiyat Hissələri</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="128x128" href="{% static 'img/favicon.png' %}">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/anaevim.css' %}">
    <link rel="stylesheet" href="{% static 'css/catalogue.css' %}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header__container container">
            <a href="{% url 'anaevim' %}" class="header__logo">
                <img src="{% static 'img/Header_Logo.png' %}" alt="AS AVTO Logo">
            </a>
            
            <nav class="header__nav">
                <ul class="header__menu">
                    <li><a href="{% url 'anaevim' %}" class="header__link">Ana Səhifə</a></li>
                    <li><a href="{% url 'catalogue' %}" class="header__link active">Kataloq</a></li>
                    <li><a href="#about" class="header__link">Haqqımızda</a></li>
                    <li><a href="#contact" class="header__link">Əlaqə</a></li>
                </ul>
                <div class="header__actions">
                    <a href="{% url 'register' %}" class="btn btn--primary btn--register">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>B4B Qeydiyyat</span>
                    </a>
                </div>

                <div class="header__actions">
                    <a href="{% url 'login' %}" class="btn btn--primary btn--login">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>B4B Giriş</span>
                    </a>
                </div>
            </nav>

            <button class="header__toggle" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="catalogue-page">
        <div class="container">
            <div class="catalogue-banner">
                <h1 class="catalogue-title">Məhsul Kataloqu</h1>
                <p class="catalogue-subtitle">Avtomobil ehtiyat hissələrini axtarın və tapın</p>
            </div>

            <!-- Axtarış bölməsi -->
            <div class="search-section">
                <div class="tabs">
                    <button class="tab-button active" data-tab="product-tab">
                        <i class="fas fa-barcode"></i> Məhsul Kodu
                    </button>
                    <button class="tab-button" data-tab="application-tab">
                        <i class="fas fa-car"></i> Marka və Model
                    </button>
                    <button class="tab-button" data-tab="vin-tab">
                        <i class="fas fa-key"></i> VIN/Şassi
                    </button>
                </div>

                <div class="tab-content">
                    <!-- Məhsul kodu ilə axtarış -->
                    <div class="tab-pane active" id="product-tab">
                        <form id="product-search-form" action="{% url 'catalogue_search' %}" method="GET">
                            <input type="hidden" name="search_type" value="product_no">
                            <div class="form-group">
                                <label for="query">Məhsul Kodu (OEM, AS kod, Brend kod)</label>
                                <div class="search-input-wrapper">
                                    <input type="text" id="query" name="query" placeholder="Kod daxil edin..." required>
                                    <button type="submit" class="search-btn">
                                        <i class="fas fa-search"></i> Axtar
                                    </button>
                                </div>
                                <small class="form-hint">OEM, AS kodları və brend kodları ilə axtarış edə bilərsiniz</small>
                            </div>
                        </form>
                    </div>

                    <!-- Avtomobil parametrləri ilə axtarış -->
                    <div class="tab-pane" id="application-tab">
                        <form id="application-search-form" action="{% url 'catalogue_search' %}" method="GET">
                            <input type="hidden" name="search_type" value="application">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="brand">Brend</label>
                                    <select id="brand" name="brand" class="form-select">
                                        <option value="">Seçin...</option>
                                        {% for brend in brendler %}
                                            <option value="{{ brend.adi }}">{{ brend.adi }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="model">Model</label>
                                    <select id="model" name="model" class="form-select">
                                        <option value="">Seçin...</option>
                                        {% for marka in markalar %}
                                            <option value="{{ marka.adi }}">{{ marka.adi }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="category">Kateqoriya</label>
                                    <select id="category" name="category" class="form-select">
                                        <option value="">Seçin...</option>
                                        {% for kateqoriya in kateqoriyalar %}
                                            <option value="{{ kateqoriya.adi }}">{{ kateqoriya.adi }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="year">İl</label>
                                    <select id="year" name="year" class="form-select">
                                        <option value="">Seçin...</option>
                                        {% for year in "2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006,2005,2004,2003,2002,2001,2000"|split:"," %}
                                            <option value="{{ year }}">{{ year }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <button type="submit" class="search-btn search-btn-full">
                                    <i class="fas fa-search"></i> Axtar
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- VIN/Şassi ilə axtarış -->
                    <div class="tab-pane" id="vin-tab">
                        <form id="vin-search-form" action="{% url 'catalogue_search' %}" method="GET">
                            <input type="hidden" name="search_type" value="vin">
                            <div class="form-group">
                                <label for="vin_number">VIN və ya Şassi Nömrəsi</label>
                                <div class="search-input-wrapper">
                                    <input type="text" id="vin_number" name="query" placeholder="VIN və ya şassi nömrəsini daxil edin..." required>
                                    <button type="submit" class="search-btn">
                                        <i class="fas fa-search"></i> Axtar
                                    </button>
                                </div>
                                <small class="form-hint">Tam VIN/şassi nömrəsini və ya bir hissəsini daxil edə bilərsiniz</small>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Populyar brendlər -->
            <div class="popular-brands">
                <h2 class="section-title">Populyar Brendlər</h2>
                <div class="brands-grid">
                    {% for brend in brendler %}
                        {% if brend.sekil %}
                            <a href="{% url 'catalogue_search' %}?search_type=application&brand={{ brend.adi }}" class="brand-item">
                                <img src="{{ brend.sekil.url }}" alt="{{ brend.adi }}">
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>

    <!-- Search Results Modal -->
    <div class="search-modal" id="searchResultsModal">
        <div class="search-modal-content">
            <div class="search-modal-header">
                <h3>Axtarış Nəticələri</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="search-modal-body">
                <div class="loading-spinner" id="loading-spinner">
                    <div class="spinner"></div>
                    <p>Nəticələr yüklənir...</p>
                </div>
                <div class="search-results" id="search-results"></div>
                <div class="no-results" id="no-results">
                    <i class="fas fa-exclamation-circle"></i>
                    <p>Axtarışınıza uyğun nəticə tapılmadı. Zəhmət olmasa, parametrləri dəyişərək yenidən cəhd edin.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer__top">
            <div class="container">
                <div class="footer__grid">
                    <div class="footer__brand">
                         <img src="{% static 'img/Header_Logo.png' %}" alt="AS AVTO Logo">
                        <p>Azərbaycanın avtomobil ehtiyat hissələri bazarında 10 ildən artıq təcrübə</p>
                        <div class="footer__social">
                            <a href="https://wa.me/994773059585" target="_blank" rel="noopener" aria-label="WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                            <a href="https://www.tiktok.com/@a_avto_service" target="_blank" rel="noopener" aria-label="TikTok">
                                <i class="fab fa-tiktok"></i>
                            </a>
                        </div>
                    </div>

                    <div class="footer__links">
                        <h3>Sürətli Keçid</h3>
                        <ul>
                            <li><a href="{% url 'anaevim' %}">Ana Səhifə</a></li>
                            <li><a href="{% url 'catalogue' %}">Kataloq</a></li>
                            <li><a href="#about">Haqqımızda</a></li>
                            <li><a href="#contact">Əlaqə</a></li>
                            <li><a href="{% url 'login' %}">B4B Giriş</a></li>
                        </ul>
                    </div>

                    <div class="footer__contact">
                        <h3>Əlaqə Məlumatları</h3>
                        <ul>
                            <li>
                                <i class="fas fa-phone"></i>
                                <a href="tel:+994773059585">+994 77 305 95 85</a>
                            </li>
                            <li>
                                <i class="fas fa-envelope"></i>
                                <a href="mailto:senan.eliyev.9997@gmail.com">senan.eliyev.9997@gmail.com</a>
                            </li>
                            <li>
                                <i class="fas fa-clock"></i>
                                <span>Bazar ertəsi - Bazar: 09:00 - 18:00</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer__bottom">
            <div class="container">
                <p>&copy; 2024-2025 AS AVTO. Bütün hüquqlar qorunur.</p>
                <div class="footer__payments">
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="{% static 'js/anaevim.js' %}"></script>
    <script src="{% static 'js/catalogue.js' %}"></script>
    <script>
        // Tab system
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabPanes = document.querySelectorAll('.tab-pane');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons and panes
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabPanes.forEach(pane => pane.classList.remove('active'));
                
                // Add active class to clicked button and corresponding pane
                button.classList.add('active');
                const tabId = button.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // AJAX axtarışı
        document.querySelectorAll('#product-search-form, #application-search-form, #vin-search-form').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const url = this.getAttribute('action');
                const searchParams = new URLSearchParams(formData);
                
                // Modal göstər və yüklənmə indikatorunu aktivləşdir
                document.getElementById('searchResultsModal').classList.add('active');
                document.getElementById('loading-spinner').style.display = 'flex';
                document.getElementById('search-results').style.display = 'none';
                document.getElementById('no-results').style.display = 'none';
                
                // AJAX sorğusu
                fetch(`${url}?${searchParams.toString()}`, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loading-spinner').style.display = 'none';
                    
                    if (data.results && data.results.length > 0) {
                        // Nəticələri göstər
                        const resultsContainer = document.getElementById('search-results');
                        
                        let resultsHTML = '<div class="results-table"><table>';
                        resultsHTML += '<thead><tr><th>Şəkil</th><th>Məhsul</th><th>Brend/Model</th><th>Kodlar</th><th>Qiymət</th><th></th></tr></thead><tbody>';
                        
                        data.results.forEach(item => {
                            resultsHTML += '<tr>';
                            
                            // Şəkil
                            resultsHTML += `<td class="result-image">
                                ${item.sekil_url ? `<img src="${item.sekil_url}" alt="${item.adi}">` : '<div class="no-image"><i class="fas fa-image"></i></div>'}
                            </td>`;
                            
                            // Məhsul adı
                            resultsHTML += `<td class="result-name">${item.adi}</td>`;
                            
                            // Brend/Model
                            resultsHTML += `<td class="result-brand">
                                <div><strong>Brend:</strong> ${item.brend}</div>
                                <div><strong>Model:</strong> ${item.marka}</div>
                            </td>`;
                            
                            // Kodlar
                            let kodlarHTML = '';
                            if (item.oem) kodlarHTML += `<div><strong>OEM:</strong> ${item.oem}</div>`;
                            if (item.as_kodu) kodlarHTML += `<div><strong>AS:</strong> ${item.as_kodu}</div>`;
                            if (item.brend_kod) kodlarHTML += `<div><strong>BREND:</strong> ${item.brend_kod}</div>`;
                            
                            if (item.oem_kodlar && item.oem_kodlar.length > 0) {
                                kodlarHTML += `<div class="extra-codes">
                                    <button class="toggle-codes" data-id="${item.id}">
                                        Əlavə kodlar (${item.oem_kodlar.length})
                                    </button>
                                    <div class="hidden-codes" id="codes-${item.id}">
                                        ${item.oem_kodlar.map(kod => `<div>${kod}</div>`).join('')}
                                    </div>
                                </div>`;
                            }
                            
                            resultsHTML += `<td class="result-codes">${kodlarHTML}</td>`;
                            
                            // Qiymət
                            resultsHTML += `<td class="result-price">${item.qiymet} AZN</td>`;
                            
                            // Əməliyyatlar
                            resultsHTML += `<td class="result-actions">
                                <a href="${item.url}" class="action-button view-button">
                                    <i class="fas fa-eye"></i> Ətraflı
                                </a>
                            </td>`;
                            
                            resultsHTML += '</tr>';
                        });
                        
                        resultsHTML += '</tbody></table></div>';
                        
                        resultsContainer.innerHTML = resultsHTML;
                        resultsContainer.style.display = 'block';
                        
                        // Əlavə kodlar üçün toggle funksiyası
                        document.querySelectorAll('.toggle-codes').forEach(button => {
                            button.addEventListener('click', function() {
                                const id = this.getAttribute('data-id');
                                const codesContainer = document.getElementById(`codes-${id}`);
                                
                                if (codesContainer.style.display === 'block') {
                                    codesContainer.style.display = 'none';
                                    this.textContent = `Əlavə kodlar (${data.results.find(item => item.id == id).oem_kodlar.length})`;
                                } else {
                                    codesContainer.style.display = 'block';
                                    this.textContent = 'Gizlət';
                                }
                            });
                        });
                        
                    } else {
                        // Nəticə tapılmadı
                        document.getElementById('no-results').style.display = 'block';
                    }
                })
                .catch(error => {
                    document.getElementById('loading-spinner').style.display = 'none';
                    document.getElementById('no-results').style.display = 'block';
                    document.getElementById('no-results').innerHTML = '<p>Xəta baş verdi. Zəhmət olmasa, bir az sonra yenidən cəhd edin.</p>';
                });
            });
        });
        
        // Modal bağlama
        document.querySelector('.close-modal').addEventListener('click', function() {
            document.getElementById('searchResultsModal').classList.remove('active');
        });
        
        // Modal xaricindən klikləndikdə bağlama
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('searchResultsModal');
            if (event.target === modal) {
                modal.classList.remove('active');
            }
        });
    </script>
</body>
</html> 