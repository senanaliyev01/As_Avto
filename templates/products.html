{% extends 'base.html' %}
{% load static %}

{% block title %}Məhsullar - AS-AVTO{% endblock %}

{% block content %}
<div class="container">
    <h2>Məhsullar</h2>
    <div id="products-list" data-has-more="{{ has_more|yesno:'true,false' }}">
        {% for mehsul in mehsullar %}
        <div class="product-row" style="position:relative;">
            <div style="position:absolute;top:10px;right:10px;z-index:2;display:flex;align-items:center;gap:8px;">
                {% for i in "12345" %}
                    <span style="color:{% if mehsul.avg_rating >= forloop.counter %}#FFD700{% elif mehsul.avg_rating >= forloop.counter0 %}#FFD70099{% else %}#ccc{% endif %};font-size:1.1rem;">&#9733;</span>
                {% endfor %}
                <span style="color:#2B5173;font-size:1rem;">{{ mehsul.avg_rating|floatformat:1 }}</span>
                <span style="color:#e74c3c;font-size:1.1rem;margin-left:8px;"><i class="fas fa-heart"></i> {{ mehsul.like_count }}</span>
                <span style="color:#888;font-size:0.95rem;margin-left:8px;">Dəyər Xalı: {{ mehsul.wilson_score|floatformat:3 }}</span>
            </div>
            <div class="product-row-image">
                <img src="{{ mehsul.sekil.url }}" alt="{{ mehsul.adi }} - {{ mehsul.brend_kod }} {{ mehsul.firma.adi }} {{ mehsul.avtomobil.adi }}" title="{{ mehsul.adi }} - {{ mehsul.brend_kod }}" loading="lazy" onclick="openImageModal('{{ mehsul.sekil.url }}')">
            </div>
            <div class="product-row-info">
                <div class="product-title"><a href="{% url 'product_detail' mehsul.id %}" style="color:inherit;text-decoration:none;">{{ mehsul.adi }} {{ mehsul.brend_kod }} {{ mehsul.firma.adi }}</a></div>
                <div class="product-meta">
                    {% if mehsul.sahib %}
                    <a href="#" class="seller-link" onclick="openUserDetailsModal({{ mehsul.sahib.id }}); return false;"><i class="fas fa-user"></i> {{ mehsul.sahib.username }}</a>
                    {% endif %}
                </div>
                <div class="product-stock">Kod: {{ mehsul.brend_kod }}</div>
                <div class="product-stock">Stok: {{ mehsul.stok }}</div>
            </div>
           
            <div class="avtomobil-logos-wrapper">
            {% for logo in mehsul.avtomobil.logolar.all %}
            <img class="avtomobil-logo" src="{{ logo.sekil.url }}" alt="{{ mehsul.avtomobil.adi }}">
            {% endfor %}
            </div>
            {% if mehsul.firma.logo %}
            <img class="firma-logo" src="{{ mehsul.firma.logo.url }}" alt="{{ mehsul.firma.adi }}">
            {% endif %}
            <div class="product-row-actions">
                <div class="product-price">{{ mehsul.qiymet }} ₼</div>
                <button type="button" class="cart-add-btn" {% if mehsul.stok == 0 %}disabled{% endif %} onclick="openQuantityModal({{ mehsul.id }}, {{ mehsul.stok }})">
                    <i class="fas fa-shopping-cart"></i>
                </button>
            </div>
        </div>
        {% empty %}
        <div class="empty-message">
            <i class="fas fa-box-open"></i>
            <p>Heç bir məhsul tapılmadı.</p>
        </div>
        {% endfor %}
    </div>
    {% if has_more %}
    <div id="loading-spinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
    </div>
    {% endif %}
</div>

<!-- Miqdar Modal -->
<div id="quantityModal" class="modal">
    <div class="custom-quantity-modal-content">
        <span class="close">&times;</span>
        <h3>Miqdar seçin</h3>
        <form method="POST" id="addToCartForm">
            {% csrf_token %}
            <input type="number" name="quantity" id="quantityInput" value="1" min="1" class="form-control">
            <div class="modal-buttons">
                <button type="button" class="btn btn-danger" onclick="closeQuantityModal()">Ləğv et</button>
                <button type="submit" class="btn btn-primary">Təsdiq et</button>
            </div>
        </form>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="image-modal">
    <span class="image-modal-close">&times;</span>
    <div class="modal-image-content">
        <img id="modalImage" class="modal-image" src="" alt="Modal Image">
    </div>
</div>

{% endblock %} 