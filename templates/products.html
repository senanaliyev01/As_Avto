{% extends 'base.html' %}
{% load static %}

{% block title %}Məhsullar - AS-AVTO{% endblock %}

{% block content %}
<div class="container">
    <h2>Məhsullar</h2>
    <div id="products-list" data-has-more="{{ has_more|yesno:'true,false' }}">
        {% for mehsul in mehsullar %}
        <div class="product-row">
            <div class="product-row-image">
                <img src="{{ mehsul.sekil.url }}" alt="{{ mehsul.adi }}" onclick="openImageModal('{{ mehsul.sekil.url }}')">
            </div>
            <div class="product-row-info">
                <div class="product-title">{{ mehsul.adi }} {{ mehsul.brend_kod }} {{ mehsul.firma.adi }} Stok: {{ mehsul.stok}}</div>
                <div class="product-meta">
                    {% if mehsul.sahib %}
                    <a href="#" class="seller-link" onclick="openUserDetailsModal({{ mehsul.sahib.id }}); return false;"><i class="fas fa-user"></i> {{ mehsul.sahib.username }}</a>
                    {% endif %}
                </div>
                <div class="product-price">{{ mehsul.qiymet }} ₼</div>
            </div>
           
            {% if mehsul.avtomobil.logo %}
            <img class="avtomobil-logo" src="{{ mehsul.avtomobil.logo.url }}" alt="{{ mehsul.avtomobil.adi }}">
            {% endif %}
            {% if mehsul.firma.logo %}
            <img class="firma-logo" src="{{ mehsul.firma.logo.url }}" alt="{{ mehsul.firma.adi }}">
            {% endif %}
            <div class="product-row-actions">
                <button type="button" class="cart-add-btn" {% if mehsul.stok == 0 %}disabled{% endif %} onclick="openQuantityModal({{ mehsul.id }}, {{ mehsul.stok }})">
                    <i class="fas fa-shopping-cart"></i>
                </button>
            </div>
        </div>
        {% empty %}
        <div class="empty-message">
            <i class="fas fa-box-open"></i>
            <p>Heç bir məhsul tapılmadı.</p>
        </div>
        {% endfor %}
    </div>
    {% if has_more %}
    <div id="loading-spinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
    </div>
    {% endif %}
</div>

<!-- Miqdar Modal -->
<div id="quantityModal" class="modal">
    <div class="custom-quantity-modal-content">
        <span class="close">&times;</span>
        <h3>Miqdar seçin</h3>
        <form method="POST" id="addToCartForm">
            {% csrf_token %}
            <input type="number" name="quantity" id="quantityInput" value="1" min="1" class="form-control">
            <div class="modal-buttons">
                <button type="button" class="btn btn-danger" onclick="closeQuantityModal()">Ləğv et</button>
                <button type="submit" class="btn btn-primary">Təsdiq et</button>
            </div>
        </form>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="image-modal">
    <span class="image-modal-close">&times;</span>
    <div class="modal-image-content">
        <img id="modalImage" class="modal-image" src="" alt="Modal Image">
    </div>
</div>

{% endblock %} 