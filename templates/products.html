{% extends 'base.html' %}
{% load static %}

{% block title %}Məhsullar - AS-AVTO{% endblock %}

{% block content %}
<div class="container">
    <h2>Məhsullar</h2>
    <div id="products-list" data-has-more="{{ has_more|yesno:'true,false' }}">
        {% for mehsul in mehsullar %}
        <div class="product-row">
            <div class="product-row-image">
                <img src="{{ mehsul.sekil.url }}" alt="{{ mehsul.adi }}" onclick="openImageModal('{{ mehsul.sekil.url }}')">
            </div>
            <div class="product-row-info">
                <div class="product-title">{{ mehsul.adi }} {{ mehsul.brend_kod }} {{ mehsul.firma.adi }}</div>
                {% if mehsul.firma.logo %}
                <div class="firma-logo-wrapper">
                    <img src="{{ mehsul.firma.logo.url }}" alt="{{ mehsul.firma.adi }} logo" class="firma-logo">
                </div>
                {% endif %}
                <div class="product-meta">
                    <span class="product-code">Stok: {{ mehsul.stok }}</span> 
                </div>
                <div class="product-price">{{ mehsul.qiymet }} ₼</div>
            </div>
            <div class="product-row-actions">
                <button type="button" class="cart-add-btn" {% if mehsul.stok == 0 %}disabled{% endif %} onclick="openQuantityModal({{ mehsul.id }}, {{ mehsul.stok }})">
                    <i class="fas fa-shopping-cart"></i>
                </button>
                <button type="button" class="details-btn" onclick="openDetailsModal({{ mehsul.id }})">
                    <i class="fas fa-info-circle"></i>
                </button>
            </div>
        </div>
        {% empty %}
        <div class="empty-message">
            <i class="fas fa-box-open"></i>
            <p>Heç bir məhsul tapılmadı.</p>
        </div>
        {% endfor %}
    </div>
    {% if has_more %}
    <div id="loading-spinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
    </div>
    {% endif %}
</div>

<!-- Miqdar Modal -->
<div id="quantityModal" class="modal">
    <div class="custom-quantity-modal-content">
        <span class="close">&times;</span>
        <h3>Miqdar seçin</h3>
        <form method="POST" id="addToCartForm">
            {% csrf_token %}
            <input type="number" name="quantity" id="quantityInput" value="1" min="1" class="form-control">
            <div class="modal-buttons">
                <button type="button" class="btn btn-danger" onclick="closeQuantityModal()">Ləğv et</button>
                <button type="submit" class="btn btn-primary">Təsdiq et</button>
            </div>
        </form>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="image-modal">
    <span class="image-modal-close">&times;</span>
    <div class="modal-image-content">
        <img id="modalImage" class="modal-image" src="" alt="Modal Image">
    </div>
</div>

<!-- Details Modal -->
<div id="detailsModal" class="details-modal">
    <div class="details-modal-content">
        <span class="details-modal-close">&times;</span>
        <div class="details-content">
            <div class="details-header">
                <h3>Məhsul Məlumatları</h3>
            </div>
            <div class="details-body">
                <div class="details-image">
                    <img id="detailsImage" src="" alt="Məhsul şəkli">
                </div>
                <div class="details-info">
                    <div class="info-row">
                        <span class="info-label">Məhsul adı:</span>
                        <span id="detailsName" class="info-value"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Kateqoriya:</span>
                        <span id="detailsCategory" class="info-value"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Firma:</span>
                        <span id="detailsFirma" class="info-value"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Avtomobil:</span>
                        <span id="detailsAvtomobil" class="info-value"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Kodu:</span>
                        <span id="detailsBrendKod" class="info-value"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ölçü:</span>
                        <span id="detailsOlcu" class="info-value"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Qiymət:</span>
                        <span id="detailsQiymet" class="info-value"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Satıcı:</span>
                        <span id="detailsSeller" class="info-value"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Stok:</span>
                        <span id="detailsStok" class="info-value"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Məlumat:</span>
                        <span id="detailsMelumat" class="info-value"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %} 